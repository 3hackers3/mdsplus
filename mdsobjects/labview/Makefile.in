include @top_srcdir@/Makefile.inc

@MINGW_TRUE@ IMPLIB=@MAKELIBDIR@LV.dll.a
LD=@CXX@
CFLAGS=@CFLAGS@ @LV_INC@ -fPIC @TARGET_ARCH@
CXXFLAGS=-g -O2 -Wno-deprecated -fPIC @CFLAGS@ @LV_INC@ @TARGET_ARCH@
CLIBS=-L@MAKESHLIBDIR@ -lMdsShr @LIBS@
CXXLIBS=-L@MAKESHLIBDIR@ -lMdsShr -lTreeShr -lTdiShr -lRtEventsShr -lMdsIpShr -lMdsObjectsCppShr -lLV @LIBS@ 

CSOURCES = lv.c

CXXSOURCES = \
	mdsdataobjectswrp.cpp  mdseventobjectswrp.cpp  mdsipobjectswrp.cpp  mdstreeobjectswrp.cpp

COBJECTS= $(CSOURCES:.c=.o)
OBJECTS = $(CXXSOURCES:.cpp=.o)
EXPORTS = MdsObjectsCppShr.exports

all : @MAKELIBDIR@ @MAKESHLIBDIR@ @MAKESHLIBDIR@@LIBPRE@LV@SHARETYPE@  @MAKELIBDIR@@LIBPRE@LV.a @MAKESHLIBDIR@@LIBPRE@MDSobjectsLVShr@SHARETYPE@ @MAKELIBDIR@@LIBPRE@MDSobjectsLVShr.a @MAKESHLIBDIR@MDSobjectsLVShr @MAKESHLIBDIR@@LIBPRE@MDSobjectsLVShr

clean:
	@ $(RM) $(COBJECTS)
	@ $(RM) $(OBJECTS)
	@ $(RM) @MAKESHLIBDIR@@LIBPRE@MDSobjectsLVShr
	@ $(RM) @MAKESHLIBDIR@MDSobjectsLVShr
	@ $(RM) @MAKESHLIBDIR@@LIBPRE@LV@SHARETYPE@ $(IMPLIB)
	@ $(RM) @MAKELIBDIR@@LIBPRE@LV.a
	@ $(RM) @MAKESHLIBDIR@@LIBPRE@MDSobjectsLVShr@SHARETYPE@
	@ $(RM) @MAKELIBDIR@@LIBPRE@MDSobjectsLVShr.a

depend:
	 @makedepend -- $(CFLAGS) -- $(SOURCES)

install: $(libdir)
	$(MKDIR_P) $(exec_prefix)/LabView
	tar cf - --exclude="CVS" MDSplus | (cd ${exec_prefix}/LabView; tar xf -)
	$(INSTALL) -m 755  @MAKESHLIBDIR@@LIBPRE@MDSobjectsLVShr@SHARETYPE@ @libdir@
	$(INSTALL) -m 755  @MAKESHLIBDIR@@LIBPRE@MDSobjectsLVShr @libdir@
	$(INSTALL) -m 755  @MAKESHLIBDIR@MDSobjectsLVShr @libdir@
	$(INSTALL) -m 755  @MAKESHLIBDIR@@LIBPRE@LV@SHARETYPE@ @libdir@

	if test @SHARETYPE@ != .a ; then \
		$(INSTALL) -m 644  @MAKELIBDIR@libTreeShr.a @libdir@; \
		$(INSTALL) -m 644  @MAKESHLIBDIR@@LIBPRE@LV.a @libdir@;\
	fi;

@MINGW_TRUE@ MAKE_IMPLIB=-Wl,--out-implib,$(IMPLIB)
@MAKESHLIBDIR@@LIBPRE@LV@SHARETYPE@ $(IMPLIB): $(COBJECTS) @EXPORTS_FILE@
	$(LD) -o $@ $(CFLAGS) @LINKSHARED@ $(COBJECTS) $(CLIBS) $(LIBS) $(MAKE_IMPLIB)

@MAKELIBDIR@@LIBPRE@LV.a : $(COBJECTS)
	$(AR) -cr $@ $(COBJECTS)
	@RANLIB@ $@

@MAKESHLIBDIR@@LIBPRE@MDSobjectsLVShr@SHARETYPE@ : $(OBJECTS) @EXPORTS_FILE@ 
	$(LD) -o $@ $(CXXFLAGS) @LINKSHARED@ $(OBJECTS) $(CXXLIBS)

@MAKELIBDIR@@LIBPRE@MDSobjectsLVShr.a : $(OBJECTS)
	$(AR) -cr $@ $(OBJECTS)
	@RANLIB@ $@

@MINGW_TRUE@ LN_MDSobjectsLVShr=cp @MAKESHLIBDIR@@LIBPRE@MDSobjectsLVShr@SHARETYPE@
@MINGW_FALSE@ LN_MDSobjectsLVShr=ln -sf @LIBPRE@MDSobjectsLVShr@SHARETYPE@
@MAKESHLIBDIR@@LIBPRE@MDSobjectsLVShr :
	$(LN_MDSobjectsLVShr)  $@

@MAKESHLIBDIR@MDSobjectsLVShr :
	$(LN_MDSobjectsLVShr)  $@


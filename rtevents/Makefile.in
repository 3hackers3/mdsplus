include @top_srcdir@/Makefile.inc

CPPFLAGS += @SRBINCLUDE@
CXXFLAGS = $(CFLAGS) $(THREAD) -Wno-deprecated
LIBS=-L@MAKESHLIBDIR@ @LIBS@ @SRBLIB@ -lMdsIpShr -lMdsShr @SOCKETLIB@
LDFLAGS += $(THREAD)

CXXSOURCES = \
	AllocationManager.cpp EventManager.cpp RelativePointer.cpp Event.cpp\
	ExitHandler.cpp TCPNetworkManager.cpp UDPNetworkManager.cpp EventHandler.cpp Notifier.cpp Thread.cpp $(WIN_CXXSOURCES)
@MINGW_TRUE@ CXXSOURCES += WindowsSharedMemory.cpp

SOURCES = MdsEvents.c
OBJECTS = $(CXXSOURCES:.cpp=.o)  $(SOURCES:.c=.o)
EXPORTS = RtEventsShr.exports

EventConnector = @MAKEBINDIR@EventConnector
RtEventsShr_shared = @MAKESHLIBDIR@libRtEventsShr@SHARETYPE@
RtEventsShr_static = @MAKELIBDIR@libRtEventsShr.a

all : @MAKELIBDIR@ @MAKESHLIBDIR@ $(EventConnector) $(RtEventsShr_shared) $(RtEventsShr_static)

clean:
	@ $(RM) $(OBJECTS)
	@ $(RM) so_locations
	@ $(RM) $(EventConnector)
	@ $(RM) $(RtEventsShr_shared)
	@ $(RM) $(RtEventsShr_static)

depend:
	 @makedepend -- $(CFLAGS) -- $(SOURCES)

install:
	$(MKDIR_P) @libdir@
	$(INSTALL) -m 755 $(RtEventsShr_shared) @libdir@
	if test @SHARETYPE@ != .a ; then \
		$(INSTALL) -m 644 $(RtEventsShr_static) @libdir@; \
	fi;

$(RtEventsShr_shared): $(OBJECTS) @EXPORTS_FILE@ 
	$(CXX) $(LDFLAGS) $(TARGET_ARCH) $(OUTPUT_OPTION) @LINKSHARED@ $^ $(LIBS)

$(RtEventsShr_static): $(OBJECTS)
	$(AR) -cr $@ $^
	$(RANLIB) $@

@MAKELIBDIR@:
	$(MKDIR_P) $@

$(EventConnector): $(RtEventsShr_shared)
	$(LINK.cc) $(OUTPUT_OPTION) EventConnector.cpp -L@MAKESHLIBDIR@ -lRtEventsShr $(LIBS) @NSLLIB@


RtEventsShr.exports: RtEventsShr.def
	sed -e /LIBRARY/\;/\;/d RtEventsShr.def > $@

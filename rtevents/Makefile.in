include @top_srcdir@/Makefile.inc

@MINGW_TRUE@ IMPLIB=@MAKELIBDIR@RtEventsShr.dll.a

CPPFLAGS += @SRBINCLUDE@
CXXFLAGS = $(CFLAGS) $(THREAD) -Wno-deprecated @CXXFLAGS@
LIBS=-L@MAKESHLIBDIR@ @LIBS@ @SRBLIB@ -lMdsIpShr -lMdsShr @SOCKETLIB@
LDFLAGS += $(THREAD) -nodefaultlibs

CXXSOURCES = \
	AllocationManager.cpp EventManager.cpp RelativePointer.cpp Event.cpp\
	ExitHandler.cpp TCPNetworkManager.cpp UDPNetworkManager.cpp EventHandler.cpp Notifier.cpp Thread.cpp $(WIN_CXXSOURCES)
@MINGW_TRUE@ CXXSOURCES += WindowsSharedMemory.cpp

SOURCES = MdsEvents.c
OBJECTS = $(CXXSOURCES:.cpp=.o)  $(SOURCES:.c=.o)
EXPORTS = RtEventsShr.exports

RtEventsShr_shared = @MAKESHLIBDIR@@LIBPRE@RtEventsShr@SHARETYPE@ $(IMPLIB)
RtEventsShr_static = @MAKELIBDIR@@LIBPRE@RtEventsShr.a

all : @MAKELIBDIR@ @MAKESHLIBDIR@ $(RtEventsShr_shared) $(RtEventsShr_static)

clean:
	@ $(RM) $(OBJECTS)
	@ $(RM) so_locations
	@ $(RM) $(RtEventsShr_shared)
	@ $(RM) $(RtEventsShr_static)

depend:
	 @makedepend -- $(CFLAGS) -- $(SOURCES)

install: $(libdir)
	$(INSTALL) -m 755 $(RtEventsShr_shared) @libdir@
	if test @SHARETYPE@ != .a ; then \
		$(INSTALL) -m 644 $(RtEventsShr_static) @libdir@; \
	fi;

@MINGW_TRUE@ MAKE_IMPLIB=-Wl,--out-implib,$(IMPLIB)
$(RtEventsShr_shared): $(OBJECTS) @EXPORTS_FILE@ 
	$(CXX) $(LDFLAGS) $(TARGET_ARCH) $(OUTPUT_OPTION) @LINKSHARED@ $^ $(LIBS) $(MAKE_IMPLIB)

$(RtEventsShr_static): $(OBJECTS)
	$(AR) -cr $@ $^
	$(RANLIB) $@


RtEventsShr.exports: RtEventsShr.def
	$(SED) -e /LIBRARY/\;/\;/d RtEventsShr.def > $@

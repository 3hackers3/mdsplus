include @top_srcdir@/Makefile.inc

@MINGW_TRUE@ IMPLIB=@MAKELIBDIR@Mdsdcl.dll.a

SOURCES = 		\
mdsdcl_dcl_parse.c		\
mdsdcl_do_command.c	\
mdsdcl_dummy.c		\
mdsdcl_general.c		\
mdsdcl_get_input.c		\
mdsdcl_initialize.c	\
mdsdcl_insert_symbols.c	\
mdsdcl_tables.c		\
MdsdclThreadSafe.c	\
mdsdcl_macros.c		\
mdsdcl_set_command.c	\
mdsdcl_show_vm.c        \
mdsdcl_spawn.c		\
mdsdcl_wait.c

OBJECTS = $(SOURCES:.c=.o)
EXPORTS = mdsdclshr.export

all: @MAKELIBDIR@ @MAKEBINDIR@ @MAKELIBDIR@libMdsdcl.a @MAKESHLIBDIR@libMdsdcl@SHARETYPE@ $(IMPLIB) @MAKEBINDIR@mdsdcl

clean:
	$(RM) $(OBJECTS)
	$(RM) @MAKELIBDIR@libMdsdcl.a @MAKESHLIBDIR@libMdsdcl@SHARETYPE@ @MAKEBINDIR@mdsdcl $(IMPLIB)

depend: 
	 @makedepend -- $(CFLAGS) -- $(SOURCES) mdsdcl.c

install: $(libdir) $(bindir)
	$(INSTALL) -m 755 @MAKEBINDIR@mdsdcl $(bindir)
	$(INSTALL) -m 755 @MAKESHLIBDIR@libMdsdcl@SHARETYPE@ $(IMPLIB) $(libdir)

cdudir = $(top_builddir)/cdu
LINK_CDU = $(cdudir)/libCdu.a
CDU = $(cdudir)/cdu

mdsdcl_tables.c: mdsdcl_tables.ocld
	if [ "@LIBPATH@" == "PATH" ]; then env PATH="@MAKESHLIBDIR@:$$(dirname $$(which gcc))" $(CDU) < $<;\
              else env @LIBPATH@=@MAKESHLIBDIR@ $(CDU) < $<; fi

@MAKELIBDIR@libMdsdcl.a: $(OBJECTS)
		$(AR) -cr $@ $^
		@RANLIB@ $@

@MINGW_TRUE@ MAKE_IMPLIB=-Wl,--out-implib,$(IMPLIB)
@MAKESHLIBDIR@libMdsdcl@SHARETYPE@ $(IMPLIB): $(OBJECTS) $(LINK_CDU)
	$(LINK.o) $(OUTPUT_OPTION) @LINKSHARED@ $^ -L@MAKESHLIBDIR@ -lMdsShr $(LIBS) $(MAKE_IMPLIB) $(THREAD)

@MAKEBINDIR@mdsdcl: mdsdcl.c $(LINK_CDU) @MAKESHLIBDIR@libMdsdcl@SHARETYPE@ $(IMPLIB)
	$(LINK.c) $(OUTPUT_OPTION) $< $(LINK_CDU) -L@MAKESHLIBDIR@ -lMdsdcl -lMdsShr

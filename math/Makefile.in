include @top_srcdir@/Makefile.inc

LD=@FORLD@
INSTALL=@top_srcdir@/conf/install-sh -c
LDLIBS = $(LIBM)

SOURCES = \
	caxpy.f \
	cgeco.f \
	cmul.f  \
	csint.f  \
	csval.f  \
	daxpy.f  \
	dcsint.f  \
	dcsval.f  \
	dgeco.f  \
	dmul.f  \
	dpermu.f  \
	dppval.f  \
	dsrch.f  \
	dsvrgn.f  \
	gn.f  \
	isrch.f  \
	msceez.f \
	mskrv2.f \
	mstrms.f \
	mskrv1.f \
	msshch.f \
	permu.f  \
	ppval.f  \
	saxpy.f  \
	sgeco.f  \
	smul.f  \
	srch.f  \
	ssrch.f  \
	svign.f  \
	svrgn.f  \
	toms510.f \
	umach.f  \
	zaxpy.f  \
	zgeco.f  \
	zmul.f

OBJECTS = $(SOURCES:.f=.o) boxsmooth.o
EXPORTS = MdsMath.export

all: @MAKESHLIBDIR@ @MAKESHLIBDIR@libMdsMath@SHARETYPE@ 

depend:
	@makedepend -- $(CFLAGS) -- $(SOURCES)

install: $(libdir)
	$(INSTALL) -m 755  @MAKESHLIBDIR@libMdsMath@SHARETYPE@ @libdir@

ifeq "@MACOSX@" ""

@MAKESHLIBDIR@libMdsMath@SHARETYPE@ libMdsMath@SHARETYPE@_i386: $(OBJECTS) 
	$(LINK.o) $(OUTPUT_OPTION) @FOR_LINKSHARED@ $^ -L@MAKESHLIBDIR@ -lMdsShr @FOR_LDFLAGS@ $(LDLIBS)

else

OBJECTS_i386 = $(SOURCES:.f=.o_i386) boxsmooth.o

%.o_i386 : %.f
	$(FC) -c $(FFLAGS) -m32 $< -o $@

EXTRA_CLEANFILES = libMdsMath@SHARETYPE@*

@MAKESHLIBDIR@libMdsMath@SHARETYPE@ : libMdsMath@SHARETYPE@ libMdsMath@SHARETYPE@_i386
	lipo -create -o $@ $^

libMdsMath@SHARETYPE@_i386: TARGET_ARCH = -m32
libMdsMath@SHARETYPE@_i386: $(OBJECTS_i386)
	$(LINK.o) $(OUTPUT_OPTION) @FOR_LINKSHARED@ $^ -L@MAKESHLIBDIR@ -lMdsShr @FOR_LDFLAGS@ $(LDLIBS)
endif

clean:
	$(RM) $(OBJECTS)
	$(RM) @MAKESHLIBDIR@libMdsMath@SHARETYPE@
	$(RM) $(EXTRA_CLEANFILES)


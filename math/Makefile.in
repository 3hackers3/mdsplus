include @top_srcdir@/Makefile.inc

LD=@FORLD@
LDLIBS = $(LIBM)

SOURCES = \
	caxpy.f \
	cgeco.f \
	cmul.f  \
	csint.f  \
	csval.f  \
	daxpy.f  \
	dcsint.f  \
	dcsval.f  \
	dgeco.f  \
	dmul.f  \
	dpermu.f  \
	dppval.f  \
	dsrch.f  \
	dsvrgn.f  \
	gn.f  \
	isrch.f  \
	msceez.f \
	mskrv2.f \
	mstrms.f \
	mskrv1.f \
	msshch.f \
	permu.f  \
	ppval.f  \
	saxpy.f  \
	sgeco.f  \
	smul.f  \
	srch.f  \
	ssrch.f  \
	svign.f  \
	svrgn.f  \
	toms510.f \
	umach.f  \
	zaxpy.f  \
	zgeco.f  \
	zmul.f

libMdsMath = @MAKESHLIBDIR@libMdsMath@SHARETYPE@
all: @MAKESHLIBDIR@ $(libMdsMath)

OBJECTS = $(SOURCES:.f=.o) boxsmooth.o
OBJECTS_i386 = $(SOURCES:.f=.o_i386) boxsmooth.o
%.o_i386 : %.f
	$(COMPILE.f) $< $(OUTPUT_OPTION)

EXPORTS = MdsMath.export

locallibMdsMath = libMdsMath@SHARETYPE@
locallibMdsMath32 = libMdsMath@SHARETYPE@_i386

ifeq "@MACOSX@" ""
LIBRARIES = $(libMdsMath)
else
LIBRARIES = $(locallibMdsMath)
$(libMdsMath): libMdsMath@SHARETYPE@ libMdsMath@SHARETYPE@_i386
	lipo -create -o $@ $^
endif

$(locallibMdsMath32) %.o_i386: TARGET_ARCH = -m32
$(locallibMdsMath32): $(OBJECTS_i386)
	$(FC) $(LDFLAGS) $(OUTPUT_OPTION) @FOR_LINKSHARED@ $^ -L@MAKESHLIBDIR@ -lMdsShr @FOR_LDFLAGS@ $(LDLIBS) $(TARGET_ARCH)

$(LIBRARIES): $(OBJECTS) 
	$(FC) $(LDFLAGS) $(OUTPUT_OPTION) @FOR_LINKSHARED@ $^ -L@MAKESHLIBDIR@ -lMdsShr @FOR_LDFLAGS@ $(LDLIBS)

depend:
	@makedepend -- $(CFLAGS) -- $(SOURCES)

install: $(libdir)
	$(INSTALL) -m 755 $(libMdsMath) $(libdir)

clean:
	$(RM) $(OBJECTS) $(OBJECTS_i386)
	$(RM) $(libMdsMath) $(locallibMdsMath) $(locallibMdsMath32)

